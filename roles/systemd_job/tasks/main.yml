---
- name: Create user systemd directory if necessary
  ansible.builtin.file:
    path: "{{ systemd_dir }}"
    recurse: yes
    state: directory

- name: "Create systemd service file for {{ service_name }} job"
  ansible.builtin.template:
    src: "{{ service_template }}"
    dest: "{{ systemd_dir }}/{{ service_name }}.service"
    mode: u+rw

- name: "Create systemd timer file for {{ service_name }} job"
  ansible.builtin.template:
    src: "{{ timer_template }}"
    dest: "{{ systemd_dir }}/{{ service_name }}.timer"
    mode: u+rw

- name: Enable job timer
  ansible.builtin.systemd:
    name: "{{ service_name }}.timer"
    enabled: yes
    state: started
    scope: user
    daemon_reload: yes
