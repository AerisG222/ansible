---
- name: Create user systemd directory if necessary
  ansible.builtin.file:
    path: "{{ systemd_job_ctx.systemd_dir }}"
    recurse: true
    state: directory

- name: "Create systemd service file for {{ systemd_job_ctx.service_name }} job"
  ansible.builtin.template:
    src: "{{ systemd_job_ctx.service_template }}"
    dest: "{{ systemd_job_ctx.systemd_dir }}/{{ systemd_job_ctx.service_name }}.service"
    mode: u+rw

- name: "Create systemd timer file for {{ systemd_job_ctx.service_name }} job"
  ansible.builtin.template:
    src: "{{ systemd_job_ctx.timer_template }}"
    dest: "{{ systemd_job_ctx.systemd_dir }}/{{ systemd_job_ctx.service_name }}.timer"
    mode: u+rw

- name: Enable job timer
  ansible.builtin.systemd:
    name: "{{ systemd_job_ctx.service_name }}.timer"
    enabled: "{{ systemd_job_ctx.enable_job | default('false', true) }}"
    state: "{{ systemd_job_ctx.start_job | default('false', true) | ternary('started', 'stopped') }}"
    scope: user
    daemon_reload: true
