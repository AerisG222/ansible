---
- name: check if (ipv4) hostname is already set in hosts file
  become: yes
  ansible.builtin.command:
    argv:
      - grep
      - -E
      - '^127\.0\.0\.1.*\b{{ item }}\b.*$'
      - /etc/hosts
  ignore_errors: yes
  register: grep_hosts

- name: add host to hosts file
  become: yes
  ansible.builtin.lineinfile:
    path: /etc/hosts
    backup: yes
    backrefs: yes
    regex: "^127\\.0\\.0\\.1\\s+(.*)$"
    line: "127.0.0.1 \\1 {{ item }}"
    state: present
  when:
    - grep_hosts.rc == 1
