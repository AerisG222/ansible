- name: create multimedia-categories core
  ansible.builtin.command:
    cmd: "podman exec -it {{ solr_container.container.Name }} solr create_core -c multimedia-categories"
  ignore_errors: yes

- name: disable data driven schema
  ansible.builtin.command:
    cmd: "podman exec -it {{ solr_container.container.Name }} solr config -c multimedia-categories -p 8983 -action set-user-property -property update.autoCreateFields -value false"

- name: prepare source file path
  ansible.builtin.set_fact:
    src_path: "{{ role_path }}/files/solr_synonyms.txt"

- name: configure synonyms
  ansible.builtin.include_role:
    name: podman_copy_to_volume
  vars:
    volume_name: "{{ solr_volume.volume.Name }}"
    dest_relative_path: data/multimedia-categories/conf/synonyms.txt

- name: reload core for synonyms to take effect
  ansible.builtin.command:
    cmd: "podman exec -it {{ solr_container.container.Name }} curl 'http://127.0.0.1:8983/solr/admin/cores?action=RELOAD&core=multimedia-categories'"

- name: add / update unique key
  ansible.builtin.include_tasks: solr_define_field.yml
  loop_control:
    label: "{{ item.name }}"
  loop:
    - name: solr_id
      type: string
      uninvertible: true
      indexed: true
      stored: true
      required: true

- name: redefine unique key
  ansible.builtin.command:
    cmd: "podman exec -it {{ solr_container.container.Name }} sed -i -E 's/<uniqueKey>id<\\/uniqueKey>/<uniqueKey>solr_id<\\/uniqueKey>/' /var/solr/data/multimedia-categories/conf/managed-schema"

- name: add fields to schema
  ansible.builtin.include_tasks: solr_define_field.yml
  loop_control:
    label: "{{ item.name }}"
  loop:
    - name: camera_makes
      type: strings
      uninvertible: true
      indexed: true
      stored: true
    - name: camera_models
      type: strings
      uninvertible: true
      indexed: true
      stored: true
    - name: comment_entry_dates
      type: pdates
      uninvertible: true
      indexed: true
      stored: true
    - name: comment_messages
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: gps_coordinate
      type: location
      uninvertible: true
      indexed: true
      stored: true
    - name: gps_latitude
      type: pfloat
      uninvertible: true
      indexed: true
      stored: true
    - name: gps_longitude
      type: pfloat
      uninvertible: true
      indexed: true
      stored: true
    - name: id
      type: pint
      uninvertible: false
      indexed: false
      stored: true
      required: true
    - name: allowed_roles
      type: strings
      uninvertible: true
      indexed: true
      stored: true
      required: true
    - name: name
      type: text_en_splitting
      uninvertible: true
      indexed: true
      stored: true
      required: true
    - name: poi_names
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: poi_types
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_administrative_area_level_1
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_administrative_area_level_2
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_administrative_area_level_3
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_country
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_formatted_address
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_locality
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_neighborhood
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_postal_code
      type: strings
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_postal_code_suffix
      type: strings
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_premise
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_route
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_street_number
      type: strings
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_sub_locality_level_1
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_sub_locality_level_2
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: rg_sub_premise
      type: text_en_splitting
      multiValued: true
      uninvertible: true
      indexed: true
      stored: true
    - name: teaser_photo_height
      type: pint
      uninvertible: false
      indexed: false
      stored: true
      required: true
    - name: teaser_photo_path
      type: string
      uninvertible: false
      indexed: false
      stored: true
      required: true
    - name: teaser_photo_sq_height
      type: pint
      uninvertible: false
      indexed: false
      stored: true
      required: true
    - name: teaser_photo_sq_path
      type: string
      uninvertible: false
      indexed: false
      stored: true
      required: true
    - name: teaser_photo_sq_width
      type: pint
      uninvertible: false
      indexed: false
      stored: true
      required: true
    - name: teaser_photo_width
      type: pint
      uninvertible: false
      indexed: false
      stored: true
      required: true
    - name: type
      type: string
      uninvertible: false
      indexed: false
      stored: true
      required: true
    - name: year
      type: pint
      uninvertible: true
      indexed: true
      stored: true
      required: true
