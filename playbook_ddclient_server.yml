---
- name: Configure Servers
  hosts: servers

  tasks:
    - name: Configure Base
      ansible.builtin.include_role:
        name: fedora_base

    - name: Configure Service Accounts
      ansible.builtin.include_role:
        name: ddclient_config.service_account
      vars:
        service_accounts:
          - "{{ ddclient_config.service_account }}"

    - name: Configure sshd
      ansible.builtin.include_role:
        name: sshd
      vars:
        sshd_allow_users:
          - "{{ ansible_user }}"
          - "{{ ddclient_config.service_account }}"

    - name: Configure podman
      ansible.builtin.include_role:
        name: podman
      vars:
        podman_users:
          - "{{ ddclient_config.service_account }}"

    - name: Configure ddclient
      ansible.builtin.include_role:
        name: ddclient
      vars:
        ddclient_svc_account: "{{ ddclient_config.service_account.username }}"
